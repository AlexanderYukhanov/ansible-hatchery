- name: Prepare random number
  set_fact:
    random_postfix: "{{ 1000 | random }}"
  run_once: yes

- name: Create instance of Application Gateway -- check mode
  azure_rm_applicationgateway:
    resource_group: "{{ resource_group }}"
    name: "appgateway{{ random_postfix }}{{ resource_group | hash('md5') | truncate(7, True, '') }}"
    ssl_policy:
      disabled_ssl_protocols:
        - TLSv1_0
      cipher_suites:
        - BBB
    gateway_ip_configurations:
    authentication_certificates:
    ssl_certificates:
    frontend_ip_configurations:
    frontend_ports:
    probes:
      - match:
          status_codes:
            - CCC
    backend_address_pools:
      - id: "/subscriptions/685ba005-af8d-4b04-8f16-a7bf38b2eb5a/resourceGroups/ansible-demo-rg/providers/Microsoft.Network/virtualNetworks/myVMVNET"
    backend_http_settings_collection:
      - authentication_certificates:
    http_listeners:
    url_path_maps:
      - path_rules:
          - paths:
              - FFF
    request_routing_rules:
    redirect_configurations:
      - request_routing_rules:
        url_path_maps:
        path_rules:
    web_application_firewall_configuration:
      enabled: False
      disabled_rule_groups:
        - rule_group_name: rulegroup
          rules:
            - 10
      rule_set_version: 12
      rule_set_type: OWASP
      firewall_mode: Prevention
  register: output
- name: Assert the resource instance is well created
  assert:
    that:
      - output.changed

- name: Create instance of Application Gateway
  azure_rm_applicationgateway:
    resource_group: "{{ resource_group }}"
    name: "appgateway{{ random_postfix }}{{ resource_group | hash('md5') | truncate(7, True, '') }}"
    ssl_policy:
      disabled_ssl_protocols:
        - XXXX - list of values -- not implemented str
      cipher_suites:
        - XXXX - list of values -- not implemented str
    gateway_ip_configurations:
    authentication_certificates:
    ssl_certificates:
    frontend_ip_configurations:
    frontend_ports:
    probes:
      - match:
          status_codes:
            - XXXX - list of values -- not implemented str
    backend_address_pools:
      - backend_ip_configurations:
          - application_gateway_backend_address_pools:
              - backend_ip_configurations:
                  - application_gateway_backend_address_pools:
                    load_balancer_backend_address_pools:
                    load_balancer_inbound_nat_rules:
                    application_security_groups:
                backend_addresses:
            load_balancer_backend_address_pools:
            load_balancer_inbound_nat_rules:
            subnet:
              network_security_group:
                security_rules:
                default_security_rules:
              route_table:
                routes:
              service_endpoints:
                - locations:
                    - XXXX - list of values -- not implemented str
              resource_navigation_links:
            public_ip_address:
              zones:
                - XXXX - list of values -- not implemented str
            application_security_groups:
        backend_addresses:
    backend_http_settings_collection:
      - authentication_certificates:
    http_listeners:
    url_path_maps:
      - path_rules:
          - paths:
              - XXXX - list of values -- not implemented str
    request_routing_rules:
    redirect_configurations:
      - request_routing_rules:
        url_path_maps:
        path_rules:
    web_application_firewall_configuration:
      disabled_rule_groups:
        - rules:
            - XXXX - list of values -- not implemented int
  register: output
- name: Assert the resource instance is well created
  assert:
    that:
      - output.changed

- name: Create again instance of Application Gateway
  azure_rm_applicationgateway:
    resource_group: "{{ resource_group }}"
    name: "appgateway{{ random_postfix }}{{ resource_group | hash('md5') | truncate(7, True, '') }}"
    ssl_policy:
      disabled_ssl_protocols:
        - XXXX - list of values -- not implemented str
      cipher_suites:
        - XXXX - list of values -- not implemented str
    gateway_ip_configurations:
    authentication_certificates:
    ssl_certificates:
    frontend_ip_configurations:
    frontend_ports:
    probes:
      - match:
          status_codes:
            - XXXX - list of values -- not implemented str
    backend_address_pools:
      - backend_ip_configurations:
          - application_gateway_backend_address_pools:
              - backend_ip_configurations:
                  - application_gateway_backend_address_pools:
                    load_balancer_backend_address_pools:
                    load_balancer_inbound_nat_rules:
                    application_security_groups:
                backend_addresses:
            load_balancer_backend_address_pools:
            load_balancer_inbound_nat_rules:
            subnet:
              network_security_group:
                security_rules:
                default_security_rules:
              route_table:
                routes:
              service_endpoints:
                - locations:
                    - XXXX - list of values -- not implemented str
              resource_navigation_links:
            public_ip_address:
              zones:
                - XXXX - list of values -- not implemented str
            application_security_groups:
        backend_addresses:
    backend_http_settings_collection:
      - authentication_certificates:
    http_listeners:
    url_path_maps:
      - path_rules:
          - paths:
              - XXXX - list of values -- not implemented str
    request_routing_rules:
    redirect_configurations:
      - request_routing_rules:
        url_path_maps:
        path_rules:
    web_application_firewall_configuration:
      disabled_rule_groups:
        - rules:
            - XXXX - list of values -- not implemented int
  register: output
- name: Assert the state has not changed
  assert:
    that:
      - output.changed == false

- name: Delete instance of Application Gateway -- check mode
  azure_rm_applicationgateway:
    resource_group: "{{ resource_group }}"
    name: "appgateway{{ random_postfix }}{{ resource_group | hash('md5') | truncate(7, True, '') }}"
    state: absent
  check_mode: yes
  register: output
- name: Assert the state has changed
  assert:
    that:
      - output.changed

- name: Delete instance of Application Gateway
  azure_rm_applicationgateway:
    resource_group: "{{ resource_group }}"
    name: "appgateway{{ random_postfix }}{{ resource_group | hash('md5') | truncate(7, True, '') }}"
    state: absent
  register: output
- name: Assert the state has changed
  assert:
    that:
      - output.changed

- name: Delete unexisting instance of Application Gateway
  azure_rm_applicationgateway:
    resource_group: "{{ resource_group }}"
    name: "appgateway{{ random_postfix }}{{ resource_group | hash('md5') | truncate(7, True, '') }}"
    state: absent
  register: output
- name: Assert the state has changed
  assert:
    that:
      - output.changed == false
